# .travis.yml based on https://github.com/DRMacIver/hypothesis/blob/master/.travis.yml
language: C
dist: xenial
group: travis_latest
python:
  - 3.7

env:
    global:
        - BUILD_RUNTIMES=$HOME/.runtimes
        - PYTHONHASHSEED=8675309
        - CC="ccache gcc"
        - CCACHE_NOCPP2=true
        - CCACHE_SLOPPINESS=file_macro,time_macros,include_file_ctime,include_file_mtime
        - CCACHE_NOHASHDIR=true
        - CFLAGS="-g -pipe"

    matrix:
      # These are ordered to get as much diversity in the
      # first group of parallel runs (4) as possible
      - TASK=test-py27-noembed
      - TASK=test-py37
      - TASK=test-py27
      - TASK=test-pypy
      - TASK=test-py36
      - TASK=test-pypy3
      - TASK=test-py35

matrix:
  fast_finish: true

jobs:
  include:
    - stage: cache
      script: ./scripts/install_all.sh

script:
    - make $TASK

stages:
  - cache
  - test

notifications:
  email: false


cache:
  pip: true
  directories:
    - $HOME/.venv
    - $HOME/.runtimes
    - $HOME/.wheelhouse
    - $HOME/.ccache

before_cache:
    - rm -f $HOME/.cache/pip/log/debug.log
